# ë²•ë¥  ì „ë¬¸ AI ì—ì´ì „íŠ¸ ê°œë°œ ê³„íšì„œ

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ëª©í‘œ
í•œêµ­ ë²•ë¥  ì „ë¬¸ AI ì—ì´ì „íŠ¸ ê°œë°œ - 33ê°œ MCP ë„êµ¬ë¥¼ ììœ¨ì ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ë²•ë¥  ì§ˆë¬¸ì— ì¢…í•©ì ì¸ ë‹µë³€ ì œê³µ

### 1.2 í•µì‹¬ ê¸°ëŠ¥
- **ììœ¨ì  ë„êµ¬ ì„ íƒ**: ì§ˆë¬¸ ë¶„ì„ í›„ í•„ìš”í•œ ë„êµ¬ ìë™ ê²°ì •
- **ë‹¤ë‹¨ê³„ ì¶”ë¡ **: ê²€ìƒ‰ â†’ ë¶„ì„ â†’ ë¹„êµ â†’ ì¢…í•©ì˜ ì²´ê³„ì  ì—°êµ¬
- **ì¶œì²˜ ëª…ì‹œ**: ëª¨ë“  ë‹µë³€ì— ë²•ë ¹/íŒë¡€ ê·¼ê±° ì œê³µ
- **ëŒ€í™” ë§¥ë½ ìœ ì§€**: í›„ì† ì§ˆë¬¸ ì²˜ë¦¬

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  ì›¹ UI      â”‚  â”‚  API        â”‚  â”‚  CLI        â”‚                 â”‚
â”‚  â”‚  (React)    â”‚  â”‚  (REST)     â”‚  â”‚  (í„°ë¯¸ë„)    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì—ì´ì „íŠ¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Legal Agent Core                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚ ì§ˆë¬¸ë¶„ì„ê¸° â”‚  â”‚ ê³„íšìˆ˜ë¦½ê¸° â”‚  â”‚ ë‹µë³€ìƒì„±ê¸° â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ Analyzer  â”‚â†’ â”‚ Planner   â”‚â†’ â”‚ Synthesizerâ”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   ë„êµ¬ ì‹¤í–‰ ì—”ì§„                              â”‚   â”‚
â”‚  â”‚           Tool Executor (33ê°œ ë„êµ¬ ê´€ë¦¬)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      korean-law-mcp ì„œë²„                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ ë²•ë ¹ ê²€ìƒ‰   â”‚  â”‚ íŒë¡€ ë¶„ì„   â”‚  â”‚ í•´ì„ë¡€/ì¬ê²° â”‚                 â”‚
â”‚  â”‚ (10 tools)  â”‚  â”‚ (8 tools)   â”‚  â”‚ (6 tools)   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ ë¹„êµ/ë¶„ì„   â”‚  â”‚ ìœ í‹¸ë¦¬í‹°    â”‚                                  â”‚
â”‚  â”‚ (5 tools)   â”‚  â”‚ (4 tools)   â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. 33ê°œ ë„êµ¬ ë¶„ë¥˜ ë° ì„ íƒ ì „ëµ

### 3.1 ë„êµ¬ ì¹´í…Œê³ ë¦¬

```python
TOOL_CATEGORIES = {
    "ë²•ë ¹_ê²€ìƒ‰": {
        "tools": ["search_law", "suggest_law_names", "search_all", "advanced_search"],
        "trigger_keywords": ["ë²•", "ë²•ë¥ ", "ê·œì •", "ì¡°í•­", "ì‹œí–‰ë ¹", "ì‹œí–‰ê·œì¹™"],
        "priority": 1  # ê°€ì¥ ë¨¼ì € ì‹œë„
    },

    "ì¡°ë¬¸_ì¡°íšŒ": {
        "tools": ["get_law_text", "get_batch_articles", "parse_jo_code"],
        "trigger_keywords": ["ì œXì¡°", "ì¡°ë¬¸", "ë‚´ìš©", "ê·œì • ë‚´ìš©"],
        "priority": 2  # ë²•ë ¹ ê²€ìƒ‰ í›„ ì‹¤í–‰
    },

    "íŒë¡€_ê²€ìƒ‰": {
        "tools": ["search_precedents", "get_precedent_text", "find_similar_precedents"],
        "trigger_keywords": ["íŒë¡€", "íŒê²°", "ëŒ€ë²•ì›", "ë²•ì›", "ì‚¬ë¡€"],
        "priority": 3
    },

    "íŒë¡€_ë¶„ì„": {
        "tools": ["summarize_precedent", "extract_precedent_keywords"],
        "trigger_keywords": ["ìš”ì•½", "í•µì‹¬", "íŒì‹œì‚¬í•­", "í‚¤ì›Œë“œ"],
        "priority": 4
    },

    "ë²•ë ¹_ë¹„êµë¶„ì„": {
        "tools": ["compare_old_new", "compare_articles", "get_article_history", "get_law_history"],
        "trigger_keywords": ["ê°œì •", "ë³€ê²½", "ë¹„êµ", "ì‹ êµ¬", "ì´ì „", "ê³¼ê±°"],
        "priority": 3
    },

    "ìœ„ì„_ê´€ê³„": {
        "tools": ["get_three_tier", "get_law_tree"],
        "trigger_keywords": ["ì‹œí–‰ë ¹", "ì‹œí–‰ê·œì¹™", "ìœ„ì„", "í•˜ìœ„ë²•ë ¹", "ìƒìœ„ë²•ë ¹"],
        "priority": 3
    },

    "í–‰ì •ê·œì¹™": {
        "tools": ["search_admin_rule", "get_admin_rule"],
        "trigger_keywords": ["ê³ ì‹œ", "í›ˆë ¹", "ì˜ˆê·œ", "ì§€ì¹¨"],
        "priority": 2
    },

    "ìì¹˜ë²•ê·œ": {
        "tools": ["search_ordinance", "get_ordinance"],
        "trigger_keywords": ["ì¡°ë¡€", "ì§€ë°©", "ì‹œ", "ë„", "êµ°", "êµ¬"],
        "priority": 2
    },

    "ë²•ë ¹í•´ì„": {
        "tools": ["search_interpretations", "get_interpretation_text"],
        "trigger_keywords": ["í•´ì„", "ìœ ê¶Œí•´ì„", "ì§ˆì˜", "íšŒì‹ "],
        "priority": 3
    },

    "ì¡°ì„¸_ì‹¬íŒ": {
        "tools": ["search_tax_tribunal_decisions", "get_tax_tribunal_decision_text"],
        "trigger_keywords": ["ì„¸ê¸ˆ", "ì¡°ì„¸", "êµ­ì„¸", "ì§€ë°©ì„¸", "ì‹¬íŒ", "ì¬ê²°"],
        "priority": 3
    },

    "ê´€ì„¸_í•´ì„": {
        "tools": ["search_customs_interpretations", "get_customs_interpretation_text"],
        "trigger_keywords": ["ê´€ì„¸", "ìˆ˜ì…", "ìˆ˜ì¶œ", "í†µê´€", "FTA", "ì›ì‚°ì§€"],
        "priority": 3
    },

    "í†µí•©_ì¡°íšŒ": {
        "tools": ["get_article_with_precedents"],
        "trigger_keywords": ["ì¡°ë¬¸ê³¼ íŒë¡€", "í•¨ê»˜", "ê´€ë ¨"],
        "priority": 4
    },

    "ë¶€ê°€_ì •ë³´": {
        "tools": ["get_annexes", "get_external_links", "parse_article_links", "get_law_statistics"],
        "trigger_keywords": ["ë³„í‘œ", "ì„œì‹", "ë§í¬", "í†µê³„", "ì°¸ì¡°"],
        "priority": 5
    }
}
```

### 3.2 ììœ¨ì  ë„êµ¬ ì„ íƒ ì•Œê³ ë¦¬ì¦˜

```python
class ToolSelector:
    """ì§ˆë¬¸ ë¶„ì„ í›„ ìµœì ì˜ ë„êµ¬ ì¡°í•© ì„ íƒ"""

    def analyze_question(self, question: str) -> dict:
        """ì§ˆë¬¸ ìœ í˜• ë° í•„ìš” ì •ë³´ ë¶„ì„"""
        return {
            "question_type": self._classify_question(question),
            "entities": self._extract_entities(question),
            "required_info": self._identify_required_info(question),
            "depth": self._determine_research_depth(question)
        }

    def _classify_question(self, question: str) -> str:
        """ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜"""
        patterns = {
            "ë²•ë ¹_ë‚´ìš©": r"(ë¬´ì—‡|ì–´ë–¤|ê·œì •|ë‚´ìš©|ì¡°í•­)",
            "íŒë¡€_ê²€ìƒ‰": r"(íŒë¡€|íŒê²°|ì‚¬ë¡€|ì„ ë¡€)",
            "ë²•ë ¹_ë¹„êµ": r"(ê°œì •|ë³€ê²½|ë°”ë€|ë‹¬ë¼ì§„|ë¹„êµ)",
            "ì ìš©_í•´ì„": r"(ì ìš©|í•´ì„|í•´ë‹¹|ê²½ìš°|ë•Œ)",
            "ì ˆì°¨_ì•ˆë‚´": r"(ì ˆì°¨|ë°©ë²•|ì–´ë–»ê²Œ|ì‹ ê³ |ì‹ ì²­)",
            "ë²Œì¹™_í™•ì¸": r"(ë²Œì¹™|ì²˜ë²Œ|ê³¼íƒœë£Œ|ë²Œê¸ˆ|ìœ„ë°˜)",
        }
        # íŒ¨í„´ ë§¤ì¹­ í›„ ìœ í˜• ë°˜í™˜
        for q_type, pattern in patterns.items():
            if re.search(pattern, question):
                return q_type
        return "ì¼ë°˜_ì§ˆë¬¸"

    def select_tools(self, analysis: dict) -> list:
        """ë¶„ì„ ê²°ê³¼ ê¸°ë°˜ ë„êµ¬ ì„ íƒ"""
        tools = []

        # 1ë‹¨ê³„: í•„ìˆ˜ ë„êµ¬ (í•­ìƒ í¬í•¨)
        tools.append({
            "tool": "search_law",
            "reason": "ê´€ë ¨ ë²•ë ¹ ì‹ë³„",
            "phase": 1
        })

        # 2ë‹¨ê³„: ì§ˆë¬¸ ìœ í˜•ë³„ ë„êµ¬
        if analysis["question_type"] == "íŒë¡€_ê²€ìƒ‰":
            tools.extend([
                {"tool": "search_precedents", "reason": "íŒë¡€ ê²€ìƒ‰", "phase": 2},
                {"tool": "get_precedent_text", "reason": "íŒë¡€ ìƒì„¸", "phase": 3},
                {"tool": "summarize_precedent", "reason": "íŒë¡€ ìš”ì•½", "phase": 4}
            ])

        elif analysis["question_type"] == "ë²•ë ¹_ë¹„êµ":
            tools.extend([
                {"tool": "get_law_history", "reason": "ê°œì • ì´ë ¥", "phase": 2},
                {"tool": "compare_old_new", "reason": "ì‹ êµ¬ ëŒ€ì¡°", "phase": 3}
            ])

        # 3ë‹¨ê³„: ê¹Šì´ì— ë”°ë¥¸ ì¶”ê°€ ë„êµ¬
        if analysis["depth"] == "comprehensive":
            tools.extend([
                {"tool": "search_interpretations", "reason": "í•´ì„ë¡€ í™•ì¸", "phase": 4},
                {"tool": "get_article_with_precedents", "reason": "í†µí•© ì¡°íšŒ", "phase": 4}
            ])

        return tools
```

---

## 4. ì—ì´ì „íŠ¸ í•µì‹¬ ë¡œì§

### 4.1 ë©”ì¸ ì—ì´ì „íŠ¸ í´ë˜ìŠ¤

```python
# src/agent/legal_agent.py

import asyncio
from dataclasses import dataclass
from typing import AsyncGenerator
from claude_agent_sdk import ClaudeSDKClient, query

@dataclass
class ResearchResult:
    """ì—°êµ¬ ê²°ê³¼ ë°ì´í„° í´ë˜ìŠ¤"""
    laws: list           # ê´€ë ¨ ë²•ë ¹
    articles: list       # ì¡°ë¬¸ ë‚´ìš©
    precedents: list     # ê´€ë ¨ íŒë¡€
    interpretations: list # í•´ì„ë¡€
    sources: list        # ì¶œì²˜ ëª©ë¡

class LegalAgent:
    """ë²•ë¥  ì „ë¬¸ AI ì—ì´ì „íŠ¸"""

    SYSTEM_PROMPT = """
ë‹¹ì‹ ì€ í•œêµ­ ë²•ë¥  ì „ë¬¸ AI ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

## ì—­í• 
ì‚¬ìš©ìì˜ ë²•ë¥  ì§ˆë¬¸ì— ëŒ€í•´ ê´€ë ¨ ë²•ë ¹, íŒë¡€, í•´ì„ë¡€ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ì¡°ì‚¬í•˜ì—¬
ì •í™•í•˜ê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ (33ê°œ)

### 1ë‹¨ê³„: ë²•ë ¹ ê²€ìƒ‰
- search_law: ë²•ë ¹ëª…ìœ¼ë¡œ ê²€ìƒ‰ (ì•½ì¹­ ìë™ ë³€í™˜)
- suggest_law_names: ë²•ë ¹ëª… ìë™ì™„ì„±
- search_all: ë²•ë ¹/í–‰ì •ê·œì¹™/ìì¹˜ë²•ê·œ í†µí•© ê²€ìƒ‰
- advanced_search: ê³ ê¸‰ í•„í„° ê²€ìƒ‰

### 2ë‹¨ê³„: ì¡°ë¬¸ ì¡°íšŒ
- get_law_text: íŠ¹ì • ì¡°ë¬¸ ì¡°íšŒ (search_law í›„ ì‚¬ìš©)
- get_batch_articles: ì—¬ëŸ¬ ì¡°ë¬¸ ì¼ê´„ ì¡°íšŒ
- parse_jo_code: ì¡°ë¬¸ë²ˆí˜¸ ë³€í™˜ (ì œ38ì¡° â†” 003800)

### 3ë‹¨ê³„: íŒë¡€ ê²€ìƒ‰/ë¶„ì„
- search_precedents: íŒë¡€ ê²€ìƒ‰
- get_precedent_text: íŒë¡€ ì „ë¬¸ ì¡°íšŒ
- summarize_precedent: íŒë¡€ ìš”ì•½
- extract_precedent_keywords: í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ
- find_similar_precedents: ìœ ì‚¬ íŒë¡€ ê²€ìƒ‰

### 4ë‹¨ê³„: ë²•ë ¹ ë¶„ì„
- compare_old_new: ì‹ êµ¬ë²• ëŒ€ì¡° (ê°œì • ì „í›„ ë¹„êµ)
- compare_articles: ë‘ ë²•ë ¹ ì¡°ë¬¸ ë¹„êµ
- get_three_tier: ë²•ë¥ â†’ì‹œí–‰ë ¹â†’ì‹œí–‰ê·œì¹™ ìœ„ì„ê´€ê³„
- get_law_tree: ë²•ë ¹ ì²´ê³„ íŠ¸ë¦¬ ì‹œê°í™”
- get_article_history: ì¡°ë¬¸ ê°œì • ì´ë ¥
- get_law_history: ë²•ë ¹ ë³€ê²½ ì´ë ¥

### 5ë‹¨ê³„: íŠ¹ìˆ˜ ìë£Œ
- search_admin_rule / get_admin_rule: í–‰ì •ê·œì¹™ (ê³ ì‹œ, í›ˆë ¹)
- search_ordinance / get_ordinance: ìì¹˜ë²•ê·œ (ì¡°ë¡€)
- search_interpretations / get_interpretation_text: ë²•ë ¹í•´ì„ë¡€
- search_tax_tribunal_decisions / get_tax_tribunal_decision_text: ì¡°ì„¸ì‹¬íŒ ì¬ê²°ë¡€
- search_customs_interpretations / get_customs_interpretation_text: ê´€ì„¸ì²­ í•´ì„

### ìœ í‹¸ë¦¬í‹°
- get_annexes: ë³„í‘œ/ì„œì‹ ì¡°íšŒ
- get_external_links: ê³µì‹ ì‚¬ì´íŠ¸ ë§í¬ ìƒì„±
- parse_article_links: ì¡°ë¬¸ ë‚´ ì°¸ì¡° ë¶„ì„
- get_law_statistics: ë²•ë ¹ í†µê³„
- get_article_with_precedents: ì¡°ë¬¸+íŒë¡€ í†µí•© ì¡°íšŒ

## ì‘ì—… ì›ì¹™

1. **ë‹¨ê³„ì  ì¡°ì‚¬**: ê²€ìƒ‰ â†’ ì¡°íšŒ â†’ ë¶„ì„ â†’ ì¢…í•© ìˆœì„œ ì¤€ìˆ˜
2. **ì¶œì²˜ ëª…ì‹œ**: ëª¨ë“  ì •ë³´ì— ë²•ë ¹ëª…, ì¡°ë¬¸, íŒë¡€ë²ˆí˜¸ í‘œê¸°
3. **ì •í™•ì„± ìš°ì„ **: ë¶ˆí™•ì‹¤í•œ ì •ë³´ëŠ” ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„
4. **ì‚¬ìš©ì ë§¥ë½**: ì§ˆë¬¸ì˜ ì˜ë„ì™€ ë°°ê²½ ê³ ë ¤

## ì‘ë‹µ í˜•ì‹

### ë²•ë ¹ ê´€ë ¨ ì§ˆë¬¸
```
ğŸ“‹ ê´€ë ¨ ë²•ë ¹
- [ë²•ë ¹ëª…] ì œXì¡° (ì¡°ë¬¸ ì œëª©)
  - ë‚´ìš© ìš”ì•½

âš–ï¸ ê´€ë ¨ íŒë¡€ (ìˆëŠ” ê²½ìš°)
- [íŒë¡€ë²ˆí˜¸] ìš”ì§€

ğŸ’¡ í•´ì„/ì ìš©
- ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€

ğŸ“ ì¶œì²˜
- ë²•ë ¹: [ë²•ë ¹ëª…] ì œXì¡°
- íŒë¡€: [íŒë¡€ë²ˆí˜¸]
```

## ì£¼ì˜ì‚¬í•­
- ë²•ë¥  ìë¬¸ì´ ì•„ë‹Œ ì •ë³´ ì œê³µì„ì„ ëª…ì‹œ
- ìµœì‹  ë²•ë ¹ í™•ì¸ ê¶Œê³ 
- ë³µì¡í•œ ì‚¬ì•ˆì€ ì „ë¬¸ê°€ ìƒë‹´ ê¶Œìœ 
"""

    def __init__(self, api_key: str = None, mcp_url: str = None):
        self.client = ClaudeSDKClient(
            mcp_servers={
                "korean_law": {
                    "url": mcp_url or "http://localhost:3000/sse",
                    "type": "sse"
                } if mcp_url else {
                    "command": "node",
                    "args": ["build/index.js"],
                    "env": {"LAW_OC": api_key}
                }
            },
            # ëª¨ë“  33ê°œ ë„êµ¬ í—ˆìš©
            allowed_tools=[
                # ë²•ë ¹ ê²€ìƒ‰
                "search_law", "suggest_law_names", "search_all", "advanced_search",
                # ì¡°ë¬¸ ì¡°íšŒ
                "get_law_text", "get_batch_articles", "parse_jo_code",
                # íŒë¡€
                "search_precedents", "get_precedent_text", "summarize_precedent",
                "extract_precedent_keywords", "find_similar_precedents",
                # ë²•ë ¹ ë¶„ì„
                "compare_old_new", "compare_articles", "get_three_tier",
                "get_law_tree", "get_article_history", "get_law_history",
                # í–‰ì •ê·œì¹™/ìì¹˜ë²•ê·œ
                "search_admin_rule", "get_admin_rule",
                "search_ordinance", "get_ordinance",
                # í•´ì„ë¡€
                "search_interpretations", "get_interpretation_text",
                "search_tax_tribunal_decisions", "get_tax_tribunal_decision_text",
                "search_customs_interpretations", "get_customs_interpretation_text",
                # ìœ í‹¸ë¦¬í‹°
                "get_annexes", "get_external_links", "parse_article_links",
                "get_law_statistics", "get_article_with_precedents"
            ]
        )
        self.conversation_history = []

    async def research(self, question: str) -> AsyncGenerator[dict, None]:
        """ë²•ë¥  ì—°êµ¬ ìˆ˜í–‰ - ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ"""

        # ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
        self.conversation_history.append({
            "role": "user",
            "content": question
        })

        # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + ëŒ€í™” ê¸°ë¡ìœ¼ë¡œ ì¿¼ë¦¬
        full_prompt = f"""
{self.SYSTEM_PROMPT}

## í˜„ì¬ ì§ˆë¬¸
{question}

## ì§€ì‹œì‚¬í•­
1. ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ í•„ìš”í•œ ë„êµ¬ë¥¼ íŒŒì•…í•˜ì„¸ìš”
2. ë‹¨ê³„ë³„ë¡œ ë„êµ¬ë¥¼ ì‹¤í–‰í•˜ì—¬ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”
3. ìˆ˜ì§‘ëœ ì •ë³´ë¥¼ ì¢…í•©í•˜ì—¬ ë‹µë³€ì„ ì‘ì„±í•˜ì„¸ìš”
4. ëª¨ë“  ì¶œì²˜ë¥¼ ëª…ì‹œí•˜ì„¸ìš”
"""

        async for event in query(
            prompt=full_prompt,
            client=self.client,
            stream=True
        ):
            if event.type == "tool_use":
                yield {
                    "type": "tool_call",
                    "tool": event.name,
                    "input": event.input,
                    "status": "executing"
                }

            elif event.type == "tool_result":
                yield {
                    "type": "tool_result",
                    "tool": event.name,
                    "result": event.content[:500] + "..." if len(event.content) > 500 else event.content
                }

            elif event.type == "text":
                yield {
                    "type": "response",
                    "content": event.text
                }

            elif event.type == "end":
                # ëŒ€í™” ê¸°ë¡ì— ì‘ë‹µ ì¶”ê°€
                self.conversation_history.append({
                    "role": "assistant",
                    "content": event.final_text
                })
                yield {
                    "type": "complete",
                    "content": event.final_text
                }

    async def ask(self, question: str) -> str:
        """ë‹¨ìˆœ ì§ˆë¬¸-ì‘ë‹µ (ìŠ¤íŠ¸ë¦¬ë° ì—†ì´)"""
        result = ""
        async for event in self.research(question):
            if event["type"] == "complete":
                result = event["content"]
        return result

    def clear_history(self):
        """ëŒ€í™” ê¸°ë¡ ì´ˆê¸°í™”"""
        self.conversation_history = []
```

### 4.2 ë„êµ¬ ì‹¤í–‰ íë¦„ ì˜ˆì‹œ

```python
# ì§ˆë¬¸: "ê´€ì„¸ë²• ì œ38ì¡° ìˆ˜ì •ì‹ ê³ ì™€ ê´€ë ¨ëœ íŒë¡€ë¥¼ ì•Œë ¤ì¤˜"

# ì—ì´ì „íŠ¸ê°€ ììœ¨ì ìœ¼ë¡œ ì„ íƒí•˜ëŠ” ë„êµ¬ ì‹œí€€ìŠ¤:

Step 1: search_law(query="ê´€ì„¸ë²•")
        â†’ lawId: "001234", mst: "100001" íšë“

Step 2: get_law_text(mst="100001", jo="ì œ38ì¡°")
        â†’ ì œ38ì¡° ìˆ˜ì •ì‹ ê³  ì¡°ë¬¸ ë‚´ìš© íšë“

Step 3: search_precedents(query="ê´€ì„¸ë²• ì œ38ì¡° ìˆ˜ì •ì‹ ê³ ")
        â†’ ê´€ë ¨ íŒë¡€ ëª©ë¡ íšë“

Step 4: get_precedent_text(id="íŒë¡€ID")
        â†’ ì£¼ìš” íŒë¡€ ì „ë¬¸ ì¡°íšŒ

Step 5: summarize_precedent(id="íŒë¡€ID")
        â†’ íŒë¡€ í•µì‹¬ ìš”ì•½

Step 6: ì¢…í•© ë‹µë³€ ìƒì„±
        â†’ ì¡°ë¬¸ ë‚´ìš© + íŒë¡€ ìš”ì§€ + ì‹¤ë¬´ ì ìš© ì•ˆë‚´
```

---

## 5. API ì„œë²„ êµ¬í˜„

### 5.1 FastAPI ì„œë²„

```python
# src/api/server.py

from fastapi import FastAPI, WebSocket, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from typing import Optional
import asyncio

from agent.legal_agent import LegalAgent

app = FastAPI(
    title="ë²•ë¥  AI ì—ì´ì „íŠ¸ API",
    description="í•œêµ­ ë²•ë¥  ì „ë¬¸ AI ì—ì´ì „íŠ¸",
    version="1.0.0"
)

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

# ì—ì´ì „íŠ¸ ì¸ìŠ¤í„´ìŠ¤ (ì„¸ì…˜ë³„ ê´€ë¦¬ í•„ìš”)
agents = {}

class QuestionRequest(BaseModel):
    question: str
    session_id: Optional[str] = "default"

class ResearchResponse(BaseModel):
    answer: str
    sources: list
    tools_used: list

@app.post("/api/ask", response_model=ResearchResponse)
async def ask_question(request: QuestionRequest):
    """ë²•ë¥  ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€"""

    # ì„¸ì…˜ë³„ ì—ì´ì „íŠ¸ ìƒì„±/ì¡°íšŒ
    if request.session_id not in agents:
        agents[request.session_id] = LegalAgent()

    agent = agents[request.session_id]

    tools_used = []
    sources = []

    async for event in agent.research(request.question):
        if event["type"] == "tool_call":
            tools_used.append(event["tool"])
        elif event["type"] == "complete":
            return ResearchResponse(
                answer=event["content"],
                sources=sources,
                tools_used=list(set(tools_used))
            )

    raise HTTPException(status_code=500, detail="ì—°êµ¬ ì‹¤íŒ¨")

@app.websocket("/ws/chat/{session_id}")
async def websocket_chat(websocket: WebSocket, session_id: str):
    """ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ…"""
    await websocket.accept()

    if session_id not in agents:
        agents[session_id] = LegalAgent()

    agent = agents[session_id]

    try:
        while True:
            question = await websocket.receive_text()

            async for event in agent.research(question):
                await websocket.send_json(event)

    except Exception as e:
        await websocket.close(code=1000)

@app.delete("/api/session/{session_id}")
async def clear_session(session_id: str):
    """ì„¸ì…˜ ì´ˆê¸°í™”"""
    if session_id in agents:
        agents[session_id].clear_history()
        del agents[session_id]
    return {"status": "cleared"}

@app.get("/health")
async def health_check():
    return {"status": "healthy"}
```

### 5.2 ì›¹ì†Œì¼“ í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ

```javascript
// í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ì˜ˆì‹œ
class LegalAgentClient {
    constructor(sessionId) {
        this.sessionId = sessionId;
        this.ws = new WebSocket(`wss://api.example.com/ws/chat/${sessionId}`);
        this.callbacks = {};
    }

    onToolCall(callback) {
        this.callbacks.tool_call = callback;
    }

    onResponse(callback) {
        this.callbacks.response = callback;
    }

    onComplete(callback) {
        this.callbacks.complete = callback;
    }

    ask(question) {
        this.ws.send(question);

        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            if (data.type === 'tool_call' && this.callbacks.tool_call) {
                this.callbacks.tool_call(data);
            } else if (data.type === 'response' && this.callbacks.response) {
                this.callbacks.response(data);
            } else if (data.type === 'complete' && this.callbacks.complete) {
                this.callbacks.complete(data);
            }
        };
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
const agent = new LegalAgentClient('user-123');

agent.onToolCall((data) => {
    console.log(`ğŸ”§ ë„êµ¬ ì‹¤í–‰ ì¤‘: ${data.tool}`);
});

agent.onResponse((data) => {
    document.getElementById('answer').innerHTML += data.content;
});

agent.onComplete((data) => {
    console.log('âœ… ì—°êµ¬ ì™„ë£Œ');
});

agent.ask('ê´€ì„¸ë²• ì œ38ì¡° ìˆ˜ì •ì‹ ê³  ê¸°í•œì€?');
```

---

## 6. í”„ë¡œì íŠ¸ êµ¬ì¡°

```
legal-ai-agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ legal_agent.py      # ë©”ì¸ ì—ì´ì „íŠ¸
â”‚   â”‚   â”œâ”€â”€ tool_selector.py    # ë„êµ¬ ì„ íƒ ë¡œì§
â”‚   â”‚   â””â”€â”€ prompts.py          # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ server.py           # FastAPI ì„œë²„
â”‚   â”‚   â””â”€â”€ models.py           # Pydantic ëª¨ë¸
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ logger.py           # ë¡œê¹…
â”‚
â”œâ”€â”€ korean-law-mcp/             # MCP ì„œë²„ (ê¸°ì¡´)
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ build/
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â””â”€â”€ test_api.py
â”‚
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile.agent
â”‚   â”œâ”€â”€ Dockerfile.mcp
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ DEPLOYMENT.md
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

---

## 7. ë°°í¬ êµ¬ì„±

### 7.1 Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  # MCP ì„œë²„
  mcp-server:
    build:
      context: ./korean-law-mcp
      dockerfile: ../docker/Dockerfile.mcp
    environment:
      - LAW_OC=${LAW_OC}
    ports:
      - "3000:3000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ì—ì´ì „íŠ¸ API ì„œë²„
  agent-api:
    build:
      context: .
      dockerfile: docker/Dockerfile.agent
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - MCP_SERVER_URL=http://mcp-server:3000/sse
    ports:
      - "8000:8000"
    depends_on:
      mcp-server:
        condition: service_healthy

  # ì›¹ í”„ë¡ íŠ¸ì—”ë“œ (ì„ íƒ)
  web-ui:
    build:
      context: ./web
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - agent-api
```

### 7.2 Railway/Render ë°°í¬

```toml
# railway.toml
[build]
  builder = "dockerfile"
  dockerfilePath = "docker/Dockerfile.agent"

[deploy]
  healthcheckPath = "/health"
  restartPolicyType = "on-failure"

[[services]]
  name = "legal-agent-api"

[[services]]
  name = "korean-law-mcp"
```

---

## 8. ê°œë°œ ë¡œë“œë§µ

### Phase 1: ê¸°ë³¸ ì—ì´ì „íŠ¸ (2ì£¼)
- [ ] Python í”„ë¡œì íŠ¸ ì„¤ì •
- [ ] LegalAgent í´ë˜ìŠ¤ êµ¬í˜„
- [ ] ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìµœì í™”
- [ ] ê¸°ë³¸ ë„êµ¬ ì„ íƒ ë¡œì§
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### Phase 2: API ì„œë²„ (1ì£¼)
- [ ] FastAPI ì„œë²„ êµ¬í˜„
- [ ] WebSocket ìŠ¤íŠ¸ë¦¬ë°
- [ ] ì„¸ì…˜ ê´€ë¦¬
- [ ] ì—ëŸ¬ í•¸ë“¤ë§

### Phase 3: ë„êµ¬ ì„ íƒ ê³ ë„í™” (2ì£¼)
- [ ] ì§ˆë¬¸ ë¶„ë¥˜ ëª¨ë¸ ê°œì„ 
- [ ] ë„êµ¬ ì²´ì´ë‹ ìµœì í™”
- [ ] ì‹¤íŒ¨ ë³µêµ¬ ë¡œì§
- [ ] ìºì‹± êµ¬í˜„

### Phase 4: ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ (1ì£¼)
- [ ] Docker ì»¨í…Œì´ë„ˆí™”
- [ ] CI/CD íŒŒì´í”„ë¼ì¸
- [ ] ë¡œê¹…/ëª¨ë‹ˆí„°ë§
- [ ] ë¬¸ì„œí™”

### Phase 5: ì›¹ UI (2ì£¼) - ì„ íƒ
- [ ] React í”„ë¡ íŠ¸ì—”ë“œ
- [ ] ì‹¤ì‹œê°„ ì±„íŒ… UI
- [ ] ë„êµ¬ ì‹¤í–‰ ì‹œê°í™”
- [ ] ì¶œì²˜ ë§í¬ ì—°ë™

---

## 9. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

```python
# tests/test_scenarios.py

TEST_CASES = [
    {
        "question": "ê´€ì„¸ë²• ì œ38ì¡° ìˆ˜ì •ì‹ ê³  ê¸°í•œì€?",
        "expected_tools": ["search_law", "get_law_text"],
        "expected_keywords": ["ìˆ˜ì •ì‹ ê³ ", "ê¸°í•œ", "ì œ38ì¡°"]
    },
    {
        "question": "í™”ê´€ë²• ìœ„ë°˜ ì‹œ ë²Œì¹™ì€?",
        "expected_tools": ["search_law", "get_law_text"],
        "expected_keywords": ["í™”í•™ë¬¼ì§ˆê´€ë¦¬ë²•", "ë²Œì¹™", "ìœ„ë°˜"]
    },
    {
        "question": "ê´€ì„¸ë²• ì œ38ì¡° ê´€ë ¨ ëŒ€ë²•ì› íŒë¡€ë¥¼ ì°¾ì•„ì¤˜",
        "expected_tools": ["search_law", "search_precedents", "get_precedent_text"],
        "expected_keywords": ["íŒë¡€", "ëŒ€ë²•ì›"]
    },
    {
        "question": "ê´€ì„¸ë²•ì´ ìµœê·¼ ì–´ë–»ê²Œ ê°œì •ë˜ì—ˆë‚˜?",
        "expected_tools": ["search_law", "get_law_history", "compare_old_new"],
        "expected_keywords": ["ê°œì •", "ë³€ê²½"]
    },
    {
        "question": "FTA ì›ì‚°ì§€ ì¦ëª… ê´€ë ¨ ê´€ì„¸ì²­ í•´ì„ì€?",
        "expected_tools": ["search_customs_interpretations", "get_customs_interpretation_text"],
        "expected_keywords": ["ì›ì‚°ì§€", "FTA", "ê´€ì„¸ì²­"]
    }
]
```

---

## 10. í–¥í›„ í™•ì¥ ê³„íš

1. **ë©€í‹°ëª¨ë‹¬ ì§€ì›**: ë²•ë ¹ ë³„í‘œ ì´ë¯¸ì§€ ë¶„ì„
2. **ë‹¤êµ­ì–´**: ì˜ë¬¸ ë²•ë ¹ ë³‘í–‰ ì œê³µ
3. **ì•Œë¦¼ ì„œë¹„ìŠ¤**: ê´€ì‹¬ ë²•ë ¹ ê°œì • ì•Œë¦¼
4. **ì „ë¬¸ê°€ ì—°ê²°**: ë³µì¡í•œ ì‚¬ì•ˆ ë³€í˜¸ì‚¬ ì—°ê²°
5. **ê¸°ì—… ë§ì¶¤í˜•**: íŠ¹ì • ì‚°ì—… ê·œì œ ëª¨ë‹ˆí„°ë§

---

## ë¶€ë¡: ì‹œì‘í•˜ê¸°

```bash
# 1. ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/your/legal-ai-agent.git
cd legal-ai-agent

# 2. í™˜ê²½ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì— API í‚¤ ì„¤ì •

# 3. ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
cd korean-law-mcp && npm install && npm run build && cd ..

# 4. ê°œë°œ ì„œë²„ ì‹¤í–‰
uvicorn src.api.server:app --reload

# 5. í…ŒìŠ¤íŠ¸
pytest tests/
```
